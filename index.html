<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plateforme Électronique avec Schémas - Ateliers S2 à S4</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <style>
        :root {
            /* Palette de couleurs professionnelle */
            --primary-blue: #2c3e50;
            --secondary-blue: #3498db;
            --accent-blue: #2980b9;
            --success-green: #27ae60;
            --warning-orange: #f39c12;
            --danger-red: #e74c3c;
            --light-gray: #ecf0f1;
            --medium-gray: #bdc3c7;
            --dark-gray: #7f8c8d;
            --white: #ffffff;
            --black: #2c3e50;
            
            /* Couleurs spécifiques aux ateliers */
            --workshop-s2: #3498db;
            --workshop-s3: #2ecc71;
            --workshop-s4: #e74c3c;
            --workshop-s2-light: #ebf5fb;
            --workshop-s3-light: #eafaf1;
            --workshop-s4-light: #fdedec;
            
            /* Variables de design */
            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
            --border-radius-xl: 20px;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 16px rgba(0,0,0,0.1);
            --shadow-xl: 0 12px 24px rgba(0,0,0,0.1);
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--black);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
            color: white;
            padding: 25px 40px;
            border-radius: var(--border-radius-lg);
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .header-left h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-left h1 i {
            background: white;
            color: var(--secondary-blue);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
        }
        
        .header-left p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
        }
        
        .header-right {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Navigation */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: var(--border-radius-lg);
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            position: sticky;
            top: 20px;
            z-index: 100;
        }
        
        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            border-bottom: 4px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        
        .nav-tab:hover {
            background: var(--light-gray);
        }
        
        .nav-tab.active {
            border-bottom-color: var(--workshop-s2);
            background: var(--workshop-s2-light);
            color: var(--workshop-s2);
        }
        
        .nav-tab.active.s3 {
            border-bottom-color: var(--workshop-s3);
            background: var(--workshop-s3-light);
            color: var(--workshop-s3);
        }
        
        .nav-tab.active.s4 {
            border-bottom-color: var(--workshop-s4);
            background: var(--workshop-s4-light);
            color: var(--workshop-s4);
        }
        
        .tab-icon {
            font-size: 1.5rem;
        }
        
        /* Content */
        .worksheet-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .worksheet-content.active {
            display: block;
        }
        
        /* Section principale avec schéma */
        .main-section {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .main-section {
                grid-template-columns: 1fr;
            }
        }
        
        /* Zone de schéma interactive */
        .schema-container {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-lg);
            min-height: 600px;
            position: relative;
            overflow: hidden;
        }
        
        .schema-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .schema-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-blue);
        }
        
        .schema-controls {
            display: flex;
            gap: 10px;
        }
        
        .schema-canvas-container {
            width: 100%;
            height: 500px;
            border: 2px dashed var(--medium-gray);
            border-radius: var(--border-radius-md);
            background: #f8f9fa;
            position: relative;
            overflow: hidden;
        }
        
        #schema-canvas {
            width: 100%;
            height: 100%;
        }
        
        .schema-legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            max-width: 200px;
            z-index: 10;
        }
        
        .legend-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-blue);
            font-size: 0.9rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.8rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .info-panel {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-lg);
        }
        
        .panel-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Composants */
        .components-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .component-item {
            background: var(--light-gray);
            border-radius: var(--border-radius-md);
            padding: 15px;
            text-align: center;
            cursor: grab;
            transition: all var(--transition-fast);
            border: 2px solid transparent;
        }
        
        .component-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            border-color: var(--secondary-blue);
        }
        
        .component-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-blue);
        }
        
        .component-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .component-desc {
            font-size: 0.75rem;
            color: var(--dark-gray);
        }
        
        /* Instructions */
        .instructions-list {
            list-style: none;
        }
        
        .instruction-item {
            padding: 15px;
            background: var(--light-gray);
            border-radius: var(--border-radius-md);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all var(--transition-fast);
        }
        
        .instruction-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }
        
        .instruction-number {
            background: var(--secondary-blue);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .instruction-text {
            flex: 1;
        }
        
        /* Formulaires */
        .form-section {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-blue);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius-md);
            font-size: 1rem;
            transition: all var(--transition-fast);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--secondary-blue);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        /* Quiz */
        .quiz-container {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
        }
        
        .quiz-question {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-blue);
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .quiz-option {
            padding: 15px;
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quiz-option:hover {
            border-color: var(--secondary-blue);
            background: rgba(52, 152, 219, 0.05);
        }
        
        .quiz-option.selected {
            border-color: var(--success-green);
            background: rgba(39, 174, 96, 0.1);
        }
        
        .quiz-option.correct {
            border-color: var(--success-green);
            background: rgba(39, 174, 96, 0.2);
        }
        
        .quiz-option.incorrect {
            border-color: var(--danger-red);
            background: rgba(231, 76, 60, 0.1);
        }
        
        /* Boutons */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-blue), var(--accent-blue));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary {
            background: var(--light-gray);
            color: var(--primary-blue);
        }
        
        .btn-secondary:hover {
            background: var(--medium-gray);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-green), #229954);
            color: white;
        }
        
        /* Progression */
        .progress-container {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .progress-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-blue);
        }
        
        .progress-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary-blue);
        }
        
        .progress-bar {
            height: 10px;
            background: var(--light-gray);
            border-radius: 5px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-blue), var(--accent-blue));
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-blue);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-gray);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        /* Schémas pré-définis */
        .schemas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .schema-card {
            background: white;
            border-radius: var(--border-radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .schema-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .schema-card-img {
            width: 100%;
            height: 150px;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--medium-gray);
            font-size: 3rem;
        }
        
        .schema-card-content {
            padding: 15px;
        }
        
        .schema-card-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary-blue);
        }
        
        .schema-card-desc {
            font-size: 0.9rem;
            color: var(--dark-gray);
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .components-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1><i class="fas fa-microchip"></i> Plateforme Électronique avec Schémas</h1>
                <p>Ateliers interactifs S2 à S4 avec schémas électroniques dynamiques et simulations</p>
            </div>
            <div class="header-right">
                <button class="btn btn-secondary" id="help-btn">
                    <i class="fas fa-question-circle"></i> Aide
                </button>
                <button class="btn btn-primary" id="export-btn">
                    <i class="fas fa-download"></i> Exporter
                </button>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav class="nav-tabs">
            <div class="nav-tab active" data-target="s2">
                <i class="fas fa-plug tab-icon"></i>
                <span>Atelier 2 - Breadboard</span>
                <small>Notre Établi Électronique</small>
            </div>
            <div class="nav-tab s3" data-target="s3">
                <i class="fas fa-toggle-on tab-icon"></i>
                <span>Atelier 3 - Boutons</span>
                <small>Ajouter l'Interactivité</small>
            </div>
            <div class="nav-tab s4" data-target="s4">
                <i class="fas fa-code tab-icon"></i>
                <span>Atelier 4 - Arduino</span>
                <small>Notre Cerveau Électronique</small>
            </div>
        </nav>
        
        <!-- Atelier 2 - Breadboard -->
        <section id="s2" class="worksheet-content active">
            <!-- Section principale avec schéma -->
            <div class="main-section">
                <div class="schema-container">
                    <div class="schema-header">
                        <h2 class="schema-title">Schéma Breadboard - Circuit LED de Base</h2>
                        <div class="schema-controls">
                            <button class="btn btn-secondary" id="reset-schema">
                                <i class="fas fa-redo"></i> Réinitialiser
                            </button>
                            <button class="btn btn-primary" id="auto-wire">
                                <i class="fas fa-bolt"></i> Câblage Auto
                            </button>
                        </div>
                    </div>
                    
                    <div class="schema-canvas-container">
                        <canvas id="schema-canvas"></canvas>
                        <div class="schema-legend">
                            <div class="legend-title">Légende</div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #ff4444;"></div>
                                <span>Fil + (Rouge)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #4444ff;"></div>
                                <span>Fil - (Bleu)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #ffaa00;"></div>
                                <span>LED</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #888888;"></div>
                                <span>Résistance</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <div class="sidebar">
                    <!-- Composants -->
                    <div class="info-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-puzzle-piece"></i> Composants Disponibles
                        </h3>
                        <div class="components-grid" id="components-list">
                            <div class="component-item" data-component="led" data-color="#ffaa00">
                                <i class="fas fa-lightbulb component-icon"></i>
                                <div class="component-name">LED</div>
                                <div class="component-desc">Diode Électroluminescente</div>
                            </div>
                            <div class="component-item" data-component="resistor" data-color="#888888">
                                <i class="fas fa-minus-square component-icon"></i>
                                <div class="component-name">Résistance</div>
                                <div class="component-desc">220Ω - 1kΩ</div>
                            </div>
                            <div class="component-item" data-component="wire-red" data-color="#ff4444">
                                <i class="fas fa-bolt component-icon"></i>
                                <div class="component-name">Fil Rouge</div>
                                <div class="component-desc">Connexion +</div>
                            </div>
                            <div class="component-item" data-component="wire-blue" data-color="#4444ff">
                                <i class="fas fa-bolt component-icon"></i>
                                <div class="component-name">Fil Bleu</div>
                                <div class="component-desc">Connexion -</div>
                            </div>
                            <div class="component-item" data-component="battery" data-color="#44aa44">
                                <i class="fas fa-battery-full component-icon"></i>
                                <div class="component-name">Pile 9V</div>
                                <div class="component-desc">Source d'alimentation</div>
                            </div>
                            <div class="component-item" data-component="breadboard" data-color="#d4a574">
                                <i class="fas fa-th component-icon"></i>
                                <div class="component-name">Breadboard</div>
                                <div class="component-desc">Plaque d'essai</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" id="clear-all">
                            <i class="fas fa-trash"></i> Tout effacer
                        </button>
                    </div>
                    
                    <!-- Instructions -->
                    <div class="info-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-list-ol"></i> Instructions
                        </h3>
                        <ol class="instructions-list">
                            <li class="instruction-item">
                                <div class="instruction-number">1</div>
                                <div class="instruction-text">Glissez les composants sur le schéma</div>
                            </li>
                            <li class="instruction-item">
                                <div class="instruction-number">2</div>
                                <div class="instruction-text">Connectez-les en cliquant sur les points</div>
                            </li>
                            <li class="instruction-item">
                                <div class="instruction-number">3</div>
                                <div class="instruction-text">Vérifiez la polarité des LED</div>
                            </li>
                            <li class="instruction-item">
                                <div class="instruction-number">4</div>
                                <div class="instruction-text">Ajoutez une résistance en série</div>
                            </li>
                            <li class="instruction-item">
                                <div class="instruction-number">5</div>
                                <div class="instruction-text">Testez votre circuit</div>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <!-- Quiz -->
            <div class="quiz-container">
                <div class="quiz-question">Quiz: Quelle est la fonction d'une résistance dans un circuit avec LED?</div>
                <div class="quiz-options">
                    <div class="quiz-option" data-correct="true">
                        <i class="fas fa-shield-alt"></i>
                        <span>Protéger la LED en limitant le courant</span>
                    </div>
                    <div class="quiz-option">
                        <i class="fas fa-bolt"></i>
                        <span>Augmenter la luminosité de la LED</span>
                    </div>
                    <div class="quiz-option">
                        <i class="fas fa-palette"></i>
                        <span>Changer la couleur de la LED</span>
                    </div>
                    <div class="quiz-option">
                        <i class="fas fa-battery-empty"></i>
                        <span>Réduire la consommation de la pile</span>
                    </div>
                </div>
                <button class="btn btn-success" id="check-answer" style="margin-top: 20px;">
                    <i class="fas fa-check"></i> Vérifier la réponse
                </button>
            </div>
            
            <!-- Formulaires -->
            <div class="form-section">
                <h3 class="panel-title">
                    <i class="fas fa-edit"></i> Complétez votre fiche
                </h3>
                <div class="form-group">
                    <label class="form-label">Nom du circuit:</label>
                    <input type="text" class="form-control" id="circuit-name" placeholder="Ex: Mon premier circuit LED">
                </div>
                <div class="form-group">
                    <label class="form-label">Description:</label>
                    <textarea class="form-control" id="circuit-desc" rows="3" placeholder="Décrivez votre circuit..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Difficultés rencontrées:</label>
                    <textarea class="form-control" id="circuit-difficulties" rows="2" placeholder="Quelles difficultés avez-vous rencontrées?"></textarea>
                </div>
                <button class="btn btn-primary" id="save-circuit">
                    <i class="fas fa-save"></i> Sauvegarder le circuit
                </button>
            </div>
        </section>
        
        <!-- Atelier 3 - Boutons Poussoirs -->
        <section id="s3" class="worksheet-content">
            <div class="main-section">
                <div class="schema-container">
                    <div class="schema-header">
                        <h2 class="schema-title">Schéma Circuit Bouton Poussoir</h2>
                        <div class="schema-controls">
                            <button class="btn btn-secondary" id="reset-schema-s3">
                                <i class="fas fa-redo"></i> Réinitialiser
                            </button>
                            <button class="btn btn-primary" id="simulate-circuit">
                                <i class="fas fa-play"></i> Simuler
                            </button>
                        </div>
                    </div>
                    
                    <div class="schema-canvas-container">
                        <!-- Canvas pour l'atelier 3 -->
                        <div id="button-circuit" style="width: 100%; height: 100%; background: #f8f9fa; position: relative;">
                            <!-- Ce sera rempli dynamiquement avec des composants SVG -->
                        </div>
                    </div>
                </div>
                
                <div class="sidebar">
                    <div class="info-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-info-circle"></i> Théorie - Bouton Poussoir
                        </h3>
                        <div style="line-height: 1.8;">
                            <p><strong>Fonctionnement:</strong> Un bouton poussoir est un interrupteur momentané qui ferme le circuit uniquement lorsqu'il est pressé.</p>
                            <p><strong>Pull-down:</strong> Résistance de 10kΩ qui maintient l'entrée à 0V (GND) quand le bouton est relâché.</p>
                            <p><strong>Logiques:</strong></p>
                            <ul style="padding-left: 20px; margin: 10px 0;">
                                <li><strong>SÉRIE (ET):</strong> Les deux boutons doivent être pressés</li>
                                <li><strong>PARALLÈLE (OU):</strong> Un seul bouton suffit</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="info-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-tasks"></i> Défis
                        </h3>
                        <div class="form-group">
                            <div class="form-label">Sélectionnez un défi:</div>
                            <select class="form-control" id="challenge-select">
                                <option value="simple">Circuit simple (1 bouton)</option>
                                <option value="series">Circuit série (ET logique)</option>
                                <option value="parallel">Circuit parallèle (OU logique)</option>
                                <option value="memory">Circuit mémoire (bascule)</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="load-challenge" style="width: 100%;">
                            <i class="fas fa-rocket"></i> Charger le défi
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Atelier 4 - Arduino -->
        <section id="s4" class="worksheet-content">
            <div class="main-section">
                <div class="schema-container">
                    <div class="schema-header">
                        <h2 class="schema-title">Schéma Arduino - Feu Tricolore</h2>
                        <div class="schema-controls">
                            <button class="btn btn-secondary" id="reset-schema-s4">
                                <i class="fas fa-redo"></i> Réinitialiser
                            </button>
                            <button class="btn btn-primary" id="upload-code">
                                <i class="fas fa-upload"></i> Téléverser
                            </button>
                        </div>
                    </div>
                    
                    <div class="schema-canvas-container">
                        <!-- Canvas pour l'atelier 4 -->
                        <div id="arduino-circuit" style="width: 100%; height: 100%; background: #f8f9fa; position: relative;">
                            <!-- Ce sera rempli dynamiquement -->
                        </div>
                    </div>
                </div>
                
                <div class="sidebar">
                    <div class="info-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-code"></i> Éditeur de Code
                        </h3>
                        <div class="form-group">
                            <label class="form-label">Programme Arduino:</label>
                            <textarea class="form-control" id="arduino-code" rows="12" style="font-family: monospace;">
// Feu tricolore automatique
int ledRouge = 9;
int ledJaune = 8;
int ledVert = 7;

void setup() {
  pinMode(ledRouge, OUTPUT);
  pinMode(ledJaune, OUTPUT);
  pinMode(ledVert, OUTPUT);
}

void loop() {
  // Vert
  digitalWrite(ledVert, HIGH);
  digitalWrite(ledRouge, LOW);
  digitalWrite(ledJaune, LOW);
  delay(5000);
  
  // Jaune
  digitalWrite(ledVert, LOW);
  digitalWrite(ledJaune, HIGH);
  delay(2000);
  
  // Rouge
  digitalWrite(ledJaune, LOW);
  digitalWrite(ledRouge, HIGH);
  delay(5000);
}</textarea>
                        </div>
                        <button class="btn btn-success" id="run-simulation">
                            <i class="fas fa-play"></i> Exécuter la simulation
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Progression -->
        <div class="progress-container">
            <div class="progress-header">
                <h3 class="progress-title">Progression globale</h3>
                <div class="progress-value" id="global-progress">0%</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="global-progress-fill" style="width: 0%"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                <div>
                    <strong>S2:</strong> <span id="progress-s2">0%</span>
                </div>
                <div>
                    <strong>S3:</strong> <span id="progress-s3">0%</span>
                </div>
                <div>
                    <strong>S4:</strong> <span id="progress-s4">0%</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal pour les schémas -->
    <div class="modal" id="schemas-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-project-diagram"></i> Bibliothèque de Schémas
                </h3>
                <button class="modal-close" id="close-schemas-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Sélectionnez un schéma à charger:</p>
                <div class="schemas-grid">
                    <div class="schema-card" data-schema="led-simple">
                        <div class="schema-card-img">
                            <i class="fas fa-lightbulb" style="color: #ffaa00;"></i>
                        </div>
                        <div class="schema-card-content">
                            <div class="schema-card-title">Circuit LED Simple</div>
                            <div class="schema-card-desc">LED + Résistance sur breadboard</div>
                        </div>
                    </div>
                    <div class="schema-card" data-schema="button-simple">
                        <div class="schema-card-img">
                            <i class="fas fa-toggle-on" style="color: #2ecc71;"></i>
                        </div>
                        <div class="schema-card-content">
                            <div class="schema-card-title">Bouton Poussoir</div>
                            <div class="schema-card-desc">Circuit avec pull-down</div>
                        </div>
                    </div>
                    <div class="schema-card" data-schema="traffic-light">
                        <div class="schema-card-img">
                            <i class="fas fa-traffic-light" style="color: #e74c3c;"></i>
                        </div>
                        <div class="schema-card-content">
                            <div class="schema-card-title">Feu Tricolore</div>
                            <div class="schema-card-desc">3 LEDs avec Arduino</div>
                        </div>
                    </div>
                    <div class="schema-card" data-schema="breadboard-layout">
                        <div class="schema-card-img">
                            <i class="fas fa-th" style="color: #3498db;"></i>
                        </div>
                        <div class="schema-card-content">
                            <div class="schema-card-title">Breadboard</div>
                            <div class="schema-card-desc">Vue détaillée des connexions</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal d'aide -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-question-circle"></i> Aide - Comment utiliser cette plateforme
                </h3>
                <button class="modal-close" id="close-help-modal">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Instructions d'utilisation:</h4>
                <ol style="margin-left: 20px; margin-bottom: 20px;">
                    <li><strong>Sélectionnez un atelier</strong> dans les onglets en haut</li>
                    <li><strong>Glissez les composants</strong> de la bibliothèque vers le schéma</li>
                    <li><strong>Connectez les composants</strong> en cliquant sur les points de connexion</li>
                    <li><strong>Complétez les formulaires</strong> pour chaque exercice</li>
                    <li><strong>Testez vos connaissances</strong> avec les quiz interactifs</li>
                    <li><strong>Suivez votre progression</strong> dans la barre en bas</li>
                </ol>
                
                <h4>Raccourcis clavier:</h4>
                <ul style="margin-left: 20px; margin-bottom: 20px;">
                    <li><kbd>Ctrl + S</kbd> : Sauvegarder</li>
                    <li><kbd>Ctrl + Z</kbd> : Annuler</li>
                    <li><kbd>Ctrl + Y</kbd> : Rétablir</li>
                    <li><kbd>Ctrl + D</kbd> : Dupliquer</li>
                    <li><kbd>Suppr</kbd> : Supprimer</li>
                </ul>
                
                <h4>Conseils:</h4>
                <ul style="margin-left: 20px;">
                    <li>Utilisez les schémas pré-définis pour commencer rapidement</li>
                    <li>Vérifiez toujours la polarité des LED (patte longue = +)</li>
                    <li>Ajoutez toujours une résistance en série avec une LED</li>
                    <li>Testez votre circuit étape par étape</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentWorkshop = 's2';
        let canvas = null;
        let selectedComponent = null;
        let progress = {
            s2: 0,
            s3: 0,
            s4: 0
        };
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initNavigation();
            initSchemaCanvas();
            initComponents();
            initQuiz();
            initModals();
            initProgress();
            loadDemoData();
        });
        
        // Navigation entre ateliers
        function initNavigation() {
            const tabs = document.querySelectorAll('.nav-tab');
            const contents = document.querySelectorAll('.worksheet-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const target = this.getAttribute('data-target');
                    
                    // Mettre à jour les onglets
                    tabs.forEach(t => {
                        t.classList.remove('active');
                        t.classList.remove('s3');
                        t.classList.remove('s4');
                    });
                    this.classList.add('active');
                    
                    // Mettre à jour le contenu
                    contents.forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(target).classList.add('active');
                    
                    currentWorkshop = target;
                    updateProgress();
                });
            });
        }
        
        // Initialisation du canvas pour les schémas
        function initSchemaCanvas() {
            canvas = new fabric.Canvas('schema-canvas', {
                backgroundColor: '#f8f9fa',
                selection: false,
                preserveObjectStacking: true
            });
            
            // Dessiner un breadboard de base
            drawBreadboard();
            
            // Gestion des événements
            canvas.on('mouse:down', function(options) {
                if (selectedComponent && options.target === null) {
                    addComponent(options.pointer.x, options.pointer.y);
                }
            });
            
            canvas.on('object:moving', function(options) {
                snapToGrid(options.target);
            });
        }
        
        // Dessiner un breadboard sur le canvas
        function drawBreadboard() {
            const gridSize = 20;
            const rows = 25;
            const cols = 60;
            
            // Zone principale
            const mainBoard = new fabric.Rect({
                left: 50,
                top: 50,
                width: cols * gridSize,
                height: rows * gridSize,
                fill: '#f0e6d3',
                stroke: '#c4b7a1',
                strokeWidth: 2,
                selectable: false,
                evented: false
            });
            
            // Rails d'alimentation
            const railLeft = new fabric.Rect({
                left: 50,
                top: 50,
                width: gridSize * 2,
                height: rows * gridSize,
                fill: '#ffcccc',
                stroke: '#ff4444',
                strokeWidth: 1,
                selectable: false,
                evented: false
            });
            
            const railRight = new fabric.Rect({
                left: 50 + (cols - 2) * gridSize,
                top: 50,
                width: gridSize * 2,
                height: rows * gridSize,
                fill: '#ccccff',
                stroke: '#4444ff',
                strokeWidth: 1,
                selectable: false,
                evented: false
            });
            
            // Trous du breadboard
            const holes = [];
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    // Sauter les rails
                    if (col < 2 || col >= cols - 2) continue;
                    
                    // Dessiner un trou
                    const hole = new fabric.Circle({
                        left: 50 + col * gridSize + gridSize/2 - 2,
                        top: 50 + row * gridSize + gridSize/2 - 2,
                        radius: 2,
                        fill: '#a6957d',
                        stroke: '#8a7b65',
                        strokeWidth: 1,
                        selectable: false,
                        evented: false
                    });
                    holes.push(hole);
                }
            }
            
            // Fossé central
            const fosse = new fabric.Rect({
                left: 50 + (cols/2 - 1) * gridSize,
                top: 50,
                width: gridSize * 2,
                height: rows * gridSize,
                fill: 'rgba(100, 100, 100, 0.1)',
                stroke: '#888888',
                strokeWidth: 1,
                strokeDashArray: [5, 5],
                selectable: false,
                evented: false
            });
            
            // Ajouter tous les éléments au canvas
            canvas.add(mainBoard, railLeft, railRight, ...holes, fosse);
            
            // Étiquettes
            const labelPlus = new fabric.Text('+', {
                left: 50 + gridSize,
                top: 30,
                fontSize: 16,
                fill: '#ff4444',
                fontWeight: 'bold',
                selectable: false,
                evented: false
            });
            
            const labelMinus = new fabric.Text('-', {
                left: 50 + (cols - 1) * gridSize,
                top: 30,
                fontSize: 16,
                fill: '#4444ff',
                fontWeight: 'bold',
                selectable: false,
                evented: false
            });
            
            canvas.add(labelPlus, labelMinus);
        }
        
        // Alignement sur la grille
        function snapToGrid(object) {
            const gridSize = 20;
            object.set({
                left: Math.round(object.left / gridSize) * gridSize,
                top: Math.round(object.top / gridSize) * gridSize
            });
            canvas.renderAll();
        }
        
        // Initialisation des composants interactifs
        function initComponents() {
            const components = document.querySelectorAll('.component-item');
            
            components.forEach(component => {
                component.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                    selectedComponent = this.getAttribute('data-component');
                    this.style.opacity = '0.7';
                    
                    // Feedback visuel
                    document.body.style.cursor = 'grabbing';
                });
            });
            
            document.addEventListener('mouseup', function() {
                if (selectedComponent) {
                    const component = document.querySelector(`[data-component="${selectedComponent}"]`);
                    if (component) component.style.opacity = '1';
                    selectedComponent = null;
                    document.body.style.cursor = 'default';
                }
            });
            
            // Boutons de contrôle
            document.getElementById('reset-schema').addEventListener('click', resetCanvas);
            document.getElementById('auto-wire').addEventListener('click', autoWireCircuit);
            document.getElementById('clear-all').addEventListener('click', clearComponents);
        }
        
        // Ajouter un composant au canvas
        function addComponent(x, y) {
            if (!selectedComponent) return;
            
            let component;
            const gridSize = 20;
            
            // Aligner sur la grille
            x = Math.round(x / gridSize) * gridSize;
            y = Math.round(y / gridSize) * gridSize;
            
            switch(selectedComponent) {
                case 'led':
                    component = createLED(x, y);
                    break;
                case 'resistor':
                    component = createResistor(x, y);
                    break;
                case 'wire-red':
                    component = createWire(x, y, '#ff4444');
                    break;
                case 'wire-blue':
                    component = createWire(x, y, '#4444ff');
                    break;
                case 'battery':
                    component = createBattery(x, y);
                    break;
                case 'breadboard':
                    // Ne pas ajouter de breadboard supplémentaire
                    return;
            }
            
            if (component) {
                canvas.add(component);
                canvas.setActiveObject(component);
                canvas.renderAll();
                updateProgress();
            }
        }
        
        // Créer une LED
        function createLED(x, y) {
            const led = new fabric.Group([
                // Corps de la LED
                new fabric.Circle({
                    radius: 15,
                    fill: '#ffaa00',
                    stroke: '#cc8800',
                    strokeWidth: 2
                }),
                // Symbole +
                new fabric.Text('+', {
                    fontSize: 12,
                    fill: '#ffffff',
                    fontWeight: 'bold',
                    left: -4,
                    top: -7
                }),
                // Patte longue
                new fabric.Line([0, 15, 0, 35], {
                    stroke: '#888888',
                    strokeWidth: 2
                }),
                // Patte courte
                new fabric.Line([10, 15, 10, 25], {
                    stroke: '#888888',
                    strokeWidth: 2
                })
            ], {
                left: x,
                top: y,
                hasControls: true,
                hasBorders: true,
                lockRotation: true
            });
            
            led.set('type', 'led');
            return led;
        }
        
        // Créer une résistance
        function createResistor(x, y) {
            const resistor = new fabric.Group([
                // Corps de la résistance
                new fabric.Rect({
                    width: 40,
                    height: 10,
                    fill: '#888888',
                    stroke: '#666666',
                    strokeWidth: 1
                }),
                // Bandes colorées
                new fabric.Rect({
                    width: 5,
                    height: 10,
                    fill: '#ff0000',
                    left: -15
                }),
                new fabric.Rect({
                    width: 5,
                    height: 10,
                    fill: '#0000ff',
                    left: 10
                }),
                // Pattes
                new fabric.Line([-20, 5, -15, 5], {
                    stroke: '#888888',
                    strokeWidth: 2
                }),
                new fabric.Line([25, 5, 30, 5], {
                    stroke: '#888888',
                    strokeWidth: 2
                })
            ], {
                left: x,
                top: y,
                hasControls: true,
                hasBorders: true,
                lockRotation: false
            });
            
            resistor.set('type', 'resistor');
            return resistor;
        }
        
        // Créer un fil
        function createWire(x, y, color) {
            const wire = new fabric.Line([x, y, x + 40, y], {
                stroke: color,
                strokeWidth: 3,
                strokeLineCap: 'round',
                hasControls: true,
                hasBorders: true,
                lockRotation: false
            });
            
            wire.set('type', 'wire');
            return wire;
        }
        
        // Créer une pile
        function createBattery(x, y) {
            const battery = new fabric.Group([
                // Corps
                new fabric.Rect({
                    width: 30,
                    height: 50,
                    fill: '#44aa44',
                    stroke: '#338833',
                    strokeWidth: 2
                }),
                // Borne +
                new fabric.Rect({
                    width: 10,
                    height: 5,
                    fill: '#ff4444',
                    left: 10,
                    top: -5
                }),
                // Borne -
                new fabric.Rect({
                    width: 10,
                    height: 5,
                    fill: '#4444ff',
                    left: 10,
                    top: 50
                }),
                // Symbole +
                new fabric.Text('+', {
                    fontSize: 16,
                    fill: '#ffffff',
                    fontWeight: 'bold',
                    left: 8,
                    top: 15
                }),
                // Symbole -
                new fabric.Text('-', {
                    fontSize: 16,
                    fill: '#ffffff',
                    fontWeight: 'bold',
                    left: 8,
                    top: 35
                })
            ], {
                left: x,
                top: y,
                hasControls: true,
                hasBorders: true,
                lockRotation: true
            });
            
            battery.set('type', 'battery');
            return battery;
        }
        
        // Réinitialiser le canvas
        function resetCanvas() {
            // Garder seulement le breadboard de base
            const objects = canvas.getObjects();
            objects.forEach(obj => {
                if (obj.type !== 'rect' && obj.type !== 'circle' && obj.type !== 'text' && obj.type !== 'line' && !obj.strokeDashArray) {
                    canvas.remove(obj);
                }
            });
            canvas.renderAll();
        }
        
        // Effacer tous les composants
        function clearComponents() {
            resetCanvas();
        }
        
        // Câblage automatique d'un circuit simple
        function autoWireCircuit() {
            resetCanvas();
            
            // Positionner les composants
            const battery = createBattery(150, 100);
            const resistor = createResistor(250, 150);
            const led = createLED(350, 100);
            
            // Créer les fils
            const wire1 = createWire(180, 125, '#ff4444'); // Battery+ to resistor
            wire1.set({ x1: 180, y1: 125, x2: 250, y2: 155 });
            
            const wire2 = createWire(290, 155, '#888888'); // Resistor to LED
            wire2.set({ x1: 290, y1: 155, x2: 350, y2: 135 });
            
            const wire3 = createWire(350, 165, '#4444ff'); // LED- to battery-
            wire3.set({ x1: 350, y1: 165, x2: 180, y2: 175 });
            
            // Ajouter au canvas
            canvas.add(battery, resistor, led, wire1, wire2, wire3);
            canvas.renderAll();
            
            showToast('Circuit automatique créé!', 'success');
            updateProgress();
        }
        
        // Initialisation du quiz
        function initQuiz() {
            const options = document.querySelectorAll('.quiz-option');
            const checkBtn = document.getElementById('check-answer');
            
            options.forEach(option => {
                option.addEventListener('click', function() {
                    // Désélectionner toutes les options
                    options.forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Sélectionner cette option
                    this.classList.add('selected');
                });
            });
            
            checkBtn.addEventListener('click', function() {
                const selected = document.querySelector('.quiz-option.selected');
                if (!selected) {
                    showToast('Sélectionnez une réponse d\'abord!', 'warning');
                    return;
                }
                
                const isCorrect = selected.getAttribute('data-correct') === 'true';
                
                // Afficher le résultat
                options.forEach(option => {
                    if (option.getAttribute('data-correct') === 'true') {
                        option.classList.add('correct');
                    } else if (option === selected && !isCorrect) {
                        option.classList.add('incorrect');
                    }
                });
                
                if (isCorrect) {
                    showToast('Bonne réponse! La résistance protège la LED en limitant le courant.', 'success');
                    progress.s2 += 10;
                    updateProgress();
                } else {
                    showToast('Essayez encore! Pensez à la fonction de protection.', 'error');
                }
            });
        }
        
        // Initialisation des modals
        function initModals() {
            // Modal d'aide
            document.getElementById('help-btn').addEventListener('click', function() {
                document.getElementById('help-modal').classList.add('active');
            });
            
            document.getElementById('close-help-modal').addEventListener('click', function() {
                document.getElementById('help-modal').classList.remove('active');
            });
            
            // Modal des schémas
            document.getElementById('export-btn').addEventListener('click', function() {
                document.getElementById('schemas-modal').classList.add('active');
            });
            
            document.getElementById('close-schemas-modal').addEventListener('click', function() {
                document.getElementById('schemas-modal').classList.remove('active');
            });
            
            // Charger un schéma
            const schemaCards = document.querySelectorAll('.schema-card');
            schemaCards.forEach(card => {
                card.addEventListener('click', function() {
                    const schema = this.getAttribute('data-schema');
                    loadSchema(schema);
                    document.getElementById('schemas-modal').classList.remove('active');
                    showToast(`Schéma "${schema}" chargé!`, 'success');
                });
            });
            
            // Fermer les modals en cliquant à l'extérieur
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
        }
        
        // Charger un schéma pré-défini
        function loadSchema(schemaName) {
            resetCanvas();
            
            switch(schemaName) {
                case 'led-simple':
                    autoWireCircuit();
                    break;
                case 'button-simple':
                    // Circuit avec bouton
                    const battery = createBattery(150, 100);
                    const button = createButton(250, 150);
                    const resistor = createResistor(350, 150);
                    const led = createLED(450, 100);
                    
                    canvas.add(battery, button, resistor, led);
                    // Ajouter les fils...
                    break;
                case 'traffic-light':
                    // Feu tricolore
                    const arduino = createArduino(150, 100);
                    const ledRed = createLED(300, 80);
                    ledRed.item(0).set('fill', '#ff4444');
                    const ledYellow = createLED(300, 140);
                    ledYellow.item(0).set('fill', '#ffff44');
                    const ledGreen = createLED(300, 200);
                    ledGreen.item(0).set('fill', '#44ff44');
                    
                    canvas.add(arduino, ledRed, ledYellow, ledGreen);
                    break;
            }
            
            canvas.renderAll();
        }
        
        // Créer un bouton poussoir (pour l'atelier 3)
        function createButton(x, y) {
            const button = new fabric.Group([
                new fabric.Rect({
                    width: 40,
                    height: 40,
                    fill: '#2ecc71',
                    stroke: '#27ae60',
                    strokeWidth: 2,
                    rx: 5,
                    ry: 5
                }),
                new fabric.Circle({
                    radius: 15,
                    fill: '#ffffff',
                    stroke: '#27ae60',
                    strokeWidth: 2,
                    top: -10
                }),
                new fabric.Line([-20, 20, -15, 20], {
                    stroke: '#888888',
                    strokeWidth: 2
                }),
                new fabric.Line([20, 20, 25, 20], {
                    stroke: '#888888',
                    strokeWidth: 2
                })
            ], {
                left: x,
                top: y,
                hasControls: true,
                hasBorders: true
            });
            
            button.set('type', 'button');
            return button;
        }
        
        // Créer un Arduino (pour l'atelier 4)
        function createArduino(x, y) {
            const arduino = new fabric.Group([
                new fabric.Rect({
                    width: 100,
                    height: 150,
                    fill: '#00979d',
                    stroke: '#007d82',
                    strokeWidth: 2,
                    rx: 5,
                    ry: 5
                }),
                new fabric.Text('ARDUINO', {
                    fontSize: 14,
                    fill: '#ffffff',
                    fontWeight: 'bold',
                    left: 15,
                    top: 10
                }),
                new fabric.Text('UNO', {
                    fontSize: 12,
                    fill: '#ffffff',
                    left: 35,
                    top: 30
                })
            ], {
                left: x,
                top: y,
                hasControls: true,
                hasBorders: true
            });
            
            arduino.set('type', 'arduino');
            return arduino;
        }
        
        // Initialiser la progression
        function initProgress() {
            // Charger la progression depuis le localStorage
            const savedProgress = localStorage.getItem('electronique-progress');
            if (savedProgress) {
                progress = JSON.parse(savedProgress);
            }
            
            updateProgress();
            
            // Sauvegarder automatiquement
            setInterval(saveProgress, 30000); // Toutes les 30 secondes
            
            // Sauvegarder lors de la fermeture
            window.addEventListener('beforeunload', saveProgress);
        }
        
        // Mettre à jour l'affichage de la progression
        function updateProgress() {
            // Calculer la progression globale
            const global = Math.round((progress.s2 + progress.s3 + progress.s4) / 3);
            
            // Mettre à jour l'affichage
            document.getElementById('global-progress').textContent = global + '%';
            document.getElementById('global-progress-fill').style.width = global + '%';
            
            document.getElementById('progress-s2').textContent = progress.s2 + '%';
            document.getElementById('progress-s3').textContent = progress.s3 + '%';
            document.getElementById('progress-s4').textContent = progress.s4 + '%';
            
            // Mettre à jour le dashboard
            document.getElementById('s2-progress').textContent = progress.s2 + '%';
            document.getElementById('s3-progress').textContent = progress.s3 + '%';
            document.getElementById('s4-progress').textContent = progress.s4 + '%';
            
            // Sauvegarder
            saveProgress();
        }
        
        // Sauvegarder la progression
        function saveProgress() {
            localStorage.setItem('electronique-progress', JSON.stringify(progress));
        }
        
        // Charger des données de démonstration
        function loadDemoData() {
            // Simuler une progression initiale
            progress.s2 = 30;
            progress.s3 = 15;
            progress.s4 = 5;
            
            // Simuler des activités récentes
            const activities = [
                { date: 'Aujourd\'hui', workshop: 'S2', activity: 'Circuit LED complet', duration: '15 min', status: 'Terminé' },
                { date: 'Hier', workshop: 'S3', activity: 'Bouton poussoir', duration: '10 min', status: 'En cours' },
                { date: 'Il y a 2 jours', workshop: 'S2', activity: 'Découverte breadboard', duration: '20 min', status: 'Terminé' }
            ];
            
            // Mettre à jour l'affichage
            setTimeout(updateProgress, 500);
            
            // Afficher un message de bienvenue
            setTimeout(() => {
                showToast('Bienvenue sur la plateforme électronique!', 'success');
            }, 1000);
        }
        
        // Afficher une notification
        function showToast(message, type = 'info') {
            // Créer l'élément toast
            const toast = document.createElement('div');
            toast.className = 'toast';
            if (type === 'success') toast.classList.add('toast-success');
            if (type === 'error') toast.classList.add('toast-danger');
            if (type === 'warning') toast.classList.add('toast-warning');
            
            const icon = type === 'success' ? 'fa-check-circle' : 
                         type === 'error' ? 'fa-exclamation-circle' : 
                         type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
            
            toast.innerHTML = `
                <i class="fas ${icon} toast-icon"></i>
                <div class="toast-content">
                    <div class="toast-title">${type === 'success' ? 'Succès' : type === 'error' ? 'Erreur' : type === 'warning' ? 'Attention' : 'Information'}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">&times;</button>
            `;
            
            // Ajouter au DOM
            const container = document.createElement('div');
            container.className = 'toast-container';
            document.body.appendChild(container);
            container.appendChild(toast);
            
            // Animation d'entrée
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateY(0)';
            }, 10);
            
            // Fermeture automatique
            setTimeout(() => {
                closeToast(toast, container);
            }, 5000);
            
            // Fermeture manuelle
            toast.querySelector('.toast-close').addEventListener('click', () => {
                closeToast(toast, container);
            });
        }
        
        function closeToast(toast, container) {
            toast.style.opacity = '0';
            toast.style.transform = 'translateY(20px)';
            setTimeout(() => {
                if (container.parentNode) {
                    container.parentNode.removeChild(container);
                }
            }, 300);
        }
        
        // Gestionnaires d'événements supplémentaires
        document.getElementById('save-circuit').addEventListener('click', function() {
            const name = document.getElementById('circuit-name').value;
            const desc = document.getElementById('circuit-desc').value;
            
            if (!name) {
                showToast('Veuillez donner un nom à votre circuit', 'warning');
                return;
            }
            
            // Simuler la sauvegarde
            setTimeout(() => {
                showToast(`Circuit "${name}" sauvegardé avec succès!`, 'success');
                progress.s2 += 5;
                updateProgress();
                
                // Réinitialiser le formulaire
                document.getElementById('circuit-name').value = '';
                document.getElementById('circuit-desc').value = '';
                document.getElementById('circuit-difficulties').value = '';
            }, 500);
        });
        
        // Sauvegarde automatique lors de la saisie
        const formInputs = document.querySelectorAll('.form-control');
        formInputs.forEach(input => {
            input.addEventListener('input', function() {
                progress[currentWorkshop] = Math.min(100, progress[currentWorkshop] + 0.5);
                updateProgress();
            });
        });
        
        // Raccourcis clavier
        document.addEventListener('keydown', function(e) {
            // Ctrl + S pour sauvegarder
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                document.getElementById('save-circuit').click();
            }
            
            // Ctrl + Z pour annuler
            if (e.ctrlKey && e.key === 'z') {
                e.preventDefault();
                // Implémenter l'annulation
            }
            
            // Suppr pour supprimer
            if (e.key === 'Delete' && canvas.getActiveObject()) {
                canvas.remove(canvas.getActiveObject());
                canvas.renderAll();
            }
        });
        
        // Gestionnaire pour l'atelier 3
        document.getElementById('load-challenge').addEventListener('click', function() {
            const challenge = document.getElementById('challenge-select').value;
            showToast(`Défi "${challenge}" chargé!`, 'success');
            progress.s3 += 10;
            updateProgress();
        });
        
        // Gestionnaire pour l'atelier 4
        document.getElementById('run-simulation').addEventListener('click', function() {
            const code = document.getElementById('arduino-code').value;
            showToast('Simulation du feu tricolore en cours...', 'info');
            progress.s4 += 15;
            updateProgress();
            
            // Simuler l'exécution
            setTimeout(() => {
                showToast('Simulation terminée avec succès!', 'success');
            }, 2000);
        });
        
        // Initialisation responsive
        function initResponsive() {
            function handleResize() {
                if (canvas) {
                    canvas.setDimensions({
                        width: document.querySelector('.schema-canvas-container').offsetWidth,
                        height: 500
                    });
                    canvas.renderAll();
                }
            }
            
            window.addEventListener('resize', handleResize);
            handleResize();
        }
        
        initResponsive();
    </script>
</body>
</html>
